# Telegram бот для анализа статистических данных

Этот бот использует модуль `query_llm.py` для обработки запросов пользователей и анализа статистических данных за периоды 2016-2020 и 2021-2024.

## Установка и настройка

### 1. Установка зависимостей

```bash
pip install -r requirements.txt
```

### 2. Настройка переменных окружения

Файл `.env` уже создан с токеном бота. При необходимости можно изменить токен:

```
BOT_TOKEN=ваш_токен_бота
```

### 3. Проверка путей к файлам

Убедитесь, что в файле `config.py` указаны правильные пути к CSV файлам с таблицами:
- `Список таблиц_21-24.csv`
- `Список таблиц_16-20.csv`

## Запуск бота

### Локальный запуск

```bash
python telegram_bot.py
```

### Запуск в фоновом режиме (для VPS)

```bash
nohup python telegram_bot.py > bot_output.log 2>&1 &
```

### Остановка бота

Для остановки бота используйте `Ctrl+C` или найдите процесс и завершите его:

```bash
ps aux | grep telegram_bot.py
kill <PID>
```

## Использование бота

### Команды бота

- `/start` - приветствие и инструкция
- `/help` - справка по использованию

### Примеры запросов

- "Количество предприятий в 2023 году"
- "Динамика экспорта за последние годы"
- "Статистика по регионам"
- "Показать данные по промышленности"

### Как работает бот

1. Пользователь отправляет текстовый запрос
2. Бот показывает сообщение "Анализирую данные..."
3. Запрос обрабатывается для обоих периодов (2016-2020 и 2021-2024)
4. Результаты объединяются и анализируются с помощью LLM
5. Пользователь получает итоговый анализ

## Структура проекта

```
/Users/sergejkocemirov/stat_forms/
├── telegram_bot.py          # Основной файл бота
├── config.py               # Конфигурация бота
├── query_llm.py           # Модуль анализа данных
├── .env                   # Переменные окружения
├── requirements.txt       # Зависимости
├── bot.log               # Лог файл бота
└── README_bot.md         # Эта инструкция
```

## Логирование

Бот ведет логи в файл `bot.log` и выводит их в консоль. Логи включают:
- Информацию о запуске/остановке бота
- Запросы пользователей
- Ошибки обработки

## Мониторинг

Для мониторинга работы бота можно использовать:

```bash
# Просмотр логов в реальном времени
tail -f bot.log

# Проверка статуса процесса
ps aux | grep telegram_bot.py
```

## Развертывание на VPS

1. Скопируйте все файлы проекта на VPS
2. Установите зависимости: `pip install -r requirements.txt`
3. Настройте переменные окружения в `.env`
4. Запустите бота: `nohup python telegram_bot.py > bot_output.log 2>&1 &`

## Устранение неполадок

### Бот не отвечает
- Проверьте правильность токена в `.env`
- Убедитесь, что бот запущен: `ps aux | grep telegram_bot.py`
- Проверьте логи: `tail -f bot.log`

### Ошибки обработки запросов
- Проверьте наличие файлов CSV с таблицами
- Убедитесь, что модуль `query_llm.py` работает корректно
- Проверьте настройки LLM в `query_llm.py`

### Проблемы с зависимостями
- Переустановите зависимости: `pip install -r requirements.txt --force-reinstall`
- Проверьте версию Python (требуется 3.8+)

## Контакты

Бот: [@stat_forms_bot](https://t.me/stat_forms_bot)